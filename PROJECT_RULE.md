# PROJECT RULE

## 📐 Requirements（機能・非機能要件）

### 機能要件
- 見積管理システム（案件作成、送付先設定、プレビュー、送付完了）
- 案件管理システム（sales画面での案件一覧・詳細管理）
- シフト管理システム（スプレッドシート形式での稼働管理）
- 会計管理システム（プロジェクト・見積の会計処理）

#### SalesTable詳細ビュー仕様

**注意**: これは「詳細ビュー」の表示形式。「サマリービュー」は実装後に別途説明予定。

##### 1. 全体レイアウト構成
- **基本情報列** + **日付列（火〜月）** + **曜日・帯案件列** + **詳細エリア（3列構成）**

##### 2. 左側基本情報列
- **編集アイコン**: マウスオーバー時に各レコードの左端に編集マークが出現
- **担当者**: 案件担当者名（ダミーデータ可）
- **更新者**: 最後にレコードに何かしら更新をかけたユーザ名を表示
- **ステータス**: 「起票」「連絡前」「連絡済」「連絡不要」「お断り」の5種類
  - 起票: グレー、連絡前: オレンジ、連絡済: 緑、連絡不要: 青、お断り: 赤
- **代理店**: 代理店名（ダミーデータ可）
- **詳細情報**: 
  - 「未登録」「公開済み」のステータスチップ
  - ステータスチップの**下に**案件詳細モーダルへのリンクボタンを配置（縦並び）

##### 3. 中央日付列（火曜日スタート）
- **曜日構成**: 火・水・木・金・土・日・月の7列
- **日付表示**: 各列に曜日名と日付の両方を表示
- **✓マーク**: 稼働枠がある日付に✓マークが表示される
- **土日の色設定**: 土曜日・日曜日の列は青色背景（#e3f2fd）、青色テキスト（#1976d2）

##### 4. 右側曜日・帯案件列
- **曜日列**: 「平日」または「週末」のフラグを表示（単価が変わるため）
- **帯案件列**: 
  - 帯案件の場合: ✓マーク表示
  - ✓マークの下に稼働日数を表示（例: 20日）
  - 帯案件とは「月に〇稼働して」という依頼をもらっているケース

##### 5. 詳細エリア（3列構成）

###### **左列：基本情報**
1. **イベント実施場所** - シンプルなテキスト表示
2. **担当MG名・電話番号** - シンプルなテキスト表示  
3. **開催店舗** - 経理処理と同じデザインのラベル + 店舗名
4. **連名店舗** - 経理処理と同じデザインのラベル + 店舗名
5. **フラグ** - アイコン + テキストの組み合わせ
   - 場所取りあり：緑色（#4caf50）
   - 外現場：オレンジ色（#ff9800）
   - 出張あり：青色（#2196f3）

###### **中央列：枠集計表と無料入店**
1. **枠集計表**
   - 人数・単価・交通費・売上の列構成
   - クローザー行（例：3人、¥20,000、¥5,000）
   - ガール行（例：3人、¥10,000、¥3,000）  
   - 右端に合計売上（例：¥228,000）
   - シンプルで見やすい表デザイン

2. **無料入店人数**
   - 1日目・2日目・3日目の列
   - 各日の人数（例：0人・1人・0人）
   - コンパクトな表示

###### **右列：営業担当メモ**
- 営業担当メモエリア

##### 6. 場所取り詳細ツールチップ
- **トリガー**: 場所取りありチップをクリック
- **表示方式**: ツールチップのような表示形式
- **表示内容**: 
  - 日付（稼働日と同じにならない場合もある。別途設定する日付）
  - ステータス（申請中、日程NG、通信NG、代理店確認中、確定）
  - 手配会社
  - 卸単価
  - 仕入れ単価
- **機能制限**: 表示専用（ツールチップタイトルなし、簡潔表示）

##### 7. 場所取り詳細編集機能
- **トリガー**: 編集モード時に場所取りありチップをクリック
- **表示方式**: ダイアログモーダル形式
- **表示内容**:
  - タイトルなし（スッキリとした表示）
  - テーブル形式での場所取り詳細一覧
  - 追加ボタン（右上配置）
  - 各レコードの編集・削除機能
- **ダイアログ設計**:
  - 横幅: 900px（横スクロールなしで全項目表示）
  - カラム: 日付(120px)、ステータス(140px)、手配会社(200px)、卸単価(140px)、仕入単価(140px)、操作(60px)
  - ボタン: キャンセル・登録（各100px幅で統一）
- **ステータス選択肢**: 申請中、日程NG、通信NG、代理店確認中、確定
- **金額表示**: ¥マーク付き、入力フィールドは右揃え

##### 8. 新規案件追加ダイアログ

###### **全体構成**
- **レイアウト**: 左右2列構成（基本情報｜詳細情報）
- **ダイアログサイズ**: maxWidth="lg"、フルワイド
- **スクロール**: 縦スクロール対応（maxHeight: 90vh）

###### **左列：基本情報セクション**

**イベント開催日**
- **表示形式**: 火曜日スタートの7日間グリッド表示
- **選択方式**: クリック選択（複数選択可）
- **デザイン**: 
  - 土曜日: 青系背景・文字（#e3f2fd、#1976d2）
  - 日曜日: 赤系背景・文字（#ffebee、#d32f2f）
  - 平日: 緑系背景・文字（#f1f8e9、#2e7d32）
- **選択状況**: 下部に選択済み日付をチップ形式で表示、×で削除可能

**担当者選択**
- **選択肢**: 田中、佐藤、鈴木、高橋、渡辺、伊藤、山本、中村
- **表示形式**: プルダウン選択

**代理店選択**
- **選択肢**: ピーアップ、ラネット、CS、エージェントA、マーケティング会社B
- **表示形式**: プルダウン選択

**平日or週末**
- **選択肢**: 平日、週末
- **制約**: 帯案件チェック時は選択不要（選択無効化）

**帯案件設定**
- **表示形式**: チェックボックス + 稼働日数入力フィールド
- **デフォルト稼働日数**: 20日
- **連動機能**: チェック時に平日or週末を未選択状態にリセット

**イベント実施場所**
- **選択肢**: 東京ビッグサイト、幕張メッセ、パシフィコ横浜、インテックス大阪、京都国際会館、ポートメッセなごや
- **表示形式**: プルダウン選択

**担当MG**
- **選択肢**: 山田太郎(090-1234-5678)、佐藤花子(090-2345-6789)、田中次郎(090-3456-7890)、鈴木美咲(090-4567-8901)、高橋健一(090-5678-9012)
- **表示形式**: プルダウン選択（名前と電話番号表示）

**開催店舗**
- **表示形式**: チップ表示 + 小型プルダウン（選択・変更）
- **選択肢**: 新宿店、渋谷店、池袋店、銀座店、浦和店、大宮店、横浜店、川崎店、千葉店、船橋店
- **デザイン**: 青色チップ（#2196f3背景、白文字）、削除可能
- **制約**: 単一選択（1店舗のみ）

**連名店舗**
- **表示形式**: チップ表示 + 小型プルダウン（追加）
- **選択肢**: 同上（開催店舗と重複不可）
- **デザイン**: グレーチップ（#e0e0e0背景、#666文字）、削除可能
- **制約**: 複数選択可能

###### **右列：詳細情報セクション**

**人数/単価セクション**
- **構成**: クローザー・ガール別の人数・単価・交通費設定
- **レイアウト**: 
  - 人数: 3カラム（狭め）
  - 単価: 4.5カラム（広め）
  - 交通費: 4.5カラム（広め）
- **金額表示**: ¥マーク付き、3桁区切り表示
- **背景色**: 
  - クローザー: 青系背景（#e3f2fd）
  - ガール: ピンク系背景（#fce4ec）

**フラグ設定セクション**
- **場所取りあり**: チェックボックス + 詳細設定エリア
- **外現場**: チェックボックス
- **出張あり**: チェックボックス

**場所取り詳細設定**（場所取りありチェック時のみ表示）
- **表示形式**: カード形式の動的リスト
- **カード内容**: 
  - 日付（DatePicker）
  - ステータス（申請中、日程NG、通信NG、代理店確認中、確定）
  - 手配会社（テキストフィールド）
  - 卸単価・仕入単価（¥マーク付きNumberField）
- **操作**: 削除ボタン（各カード右上）、追加ボタン（下部）
- **デフォルト値**: 新規追加時ステータスは「申請中」

###### **ダイアログ操作**
- **ボタン配置**: 下部右側にキャンセル・登録ボタン
- **バリデーション**: イベント開催日選択のみ必須（その他は任意）
- **スタイル**: 統一されたボタン幅（100px）

##### 9. データ型定義（更新版）

#### SalesSummaryView仕様

**注意**: これは「サマリービュー」の表示形式。「詳細ビュー」とは区別されるコンパクト表示。

##### 1. 全体設計思想
- **詳細ビューとの完全統一**: デザイン、操作性、機能をSalesTableと完全に同一にする
- **コンパクト表示**: 詳細エリアを1列に集約し、横幅を抑える
- **一覧性重視**: 複数レコードを効率的に確認できるレイアウト

##### 2. レイアウト構成
- **基本情報列** + **日付列（火〜月）** + **曜日・帯案件列** + **詳細エリア（1列統合）**
- **テーブル幅**: `minWidth: 2000px`（詳細ビューと同一）
- **列幅設定**: 詳細ビューと完全同一（編集30px、担当者80px、更新者90px等）

##### 3. 編集機能（詳細ビューと完全統一）
- **編集アイコン**: 各レコード左端、ホバー時表示・強調
- **編集モード切り替え**: 編集アイコンクリックで編集モード開始、チェックアイコンで終了
- **編集時の視覚変化**: 背景色変更（`#fff3e0`）、操作可能要素のカーソル・ホバー効果
- **担当者編集**: 編集モード時にSelectドロップダウンで選択可能

##### 3.5. 常時編集可能機能（編集モード不要）
- **担当者列**: クリックでポップアップ選択、ホバー効果付き
- **ステータス列**: Chipクリックでポップアップ選択、ホバー時透明度変更
- **SelectionPopups統合**: 詳細ビューと同じポップアップコンポーネント使用
- **選択後自動更新**: 選択と同時にレコード更新、ポップアップ自動閉じ

##### 3.6. 編集モード時の詳細列編集機能
- **イベント実施場所**: クリックでポップアップ選択、ホバー効果
- **フラグ編集**: 
  - 場所取り・外現場・出張フラグを常時表示
  - クリックで有効/無効切り替え
  - 無効時は薄いグレー（#ccc）表示
  - 各フラグ固有のホバー効果（緑・オレンジ・青系背景）
- **人数編集**: 
  - クローザー・ガール人数をTextFieldで数値入力
  - 幅35px、中央揃え、0-99範囲
  - リアルタイム更新機能

##### 4. 右クリック削除機能
- **コンテキストメニュー**: 右クリックで削除メニュー表示
- **削除確認ダイアログ**: DeleteConfirmDialog統合、確認後削除実行
- **メニューデザイン**: 赤色テキスト（#f4212e）、ホバー時背景色変更

##### 5. 詳細情報ドロワー連携
- **詳細情報ボタン**: ステータスチップ下に配置、クリックでドロワー表示
- **SalesDetailDrawer統合**: 詳細ビューと同じドロワーコンポーネントを使用
- **ボタンスタイル**: 0.6remフォント、ホバー効果（#e3f2fd背景）

##### 6. 日付列デザイン（詳細ビューと完全統一）
- **表示形式**: CheckboxからCheckIcon表示に変更
- **編集時操作**: 編集モード時のみクリック可能、ホバー効果追加
- **ボーダー**: 左右1px solid #e0e0e0の境界線
- **土日色分け**: 土曜日青系、日曜日赤系背景色

##### 7. 曜日列（帯案件対応デザイン）
- **通常表示**: 
  - 平日: 薄いグレー背景（#f5f5f5）
  - 週末: 薄い黄色背景（#fff9c4）
- **帯案件表示**: 
  - 表示テキスト: 「帯」
  - 背景色: 薄い青（#e3f2fd）
  - テキスト色: 濃い青（#1976d2）
  - フォント: 太字（bold）
- **編集時操作**: クリックで平日/週末切り替え可能

##### 8. 帯案件列（詳細ビューと完全統一）
- **帯案件時表示**: 
  - CheckIcon（color="primary"）
  - 編集モード時: 日数入力フィールド表示
  - 非編集モード時: 「{bandWorkDays}日」表示
- **非帯案件時表示**: 
  - 編集モード時のみ薄いアイコンとテキスト表示
- **編集時操作**: クリックで帯案件有無切り替え、ホバー効果

##### 9. 詳細列（1列統合レイアウト）
- **絶対位置レイアウト**: position: relativeの親にposition: absoluteの子要素配置
- **X座標統一**: フラグの有無に関係なく各要素の位置を固定

###### **要素配置（固定座標）**
- **イベント実施場所**: left: 0, width: '160px'
  - フォント: 0.9rem、太字
  - オーバーフロー: テキスト省略表示
- **フラグエリア**: left: '170px', width: '200px'
  - 左詰め表示（存在するフラグのみ）
  - 場所取り: 緑色LocationIcon + 「場所取り」テキスト
  - 外現場: オレンジBusinessIcon + 「外現場」テキスト  
  - 出張: 青色FlagIcon + 「出張」テキスト
- **クローザー人数**: left: '380px', width: '60px'
  - PersonIcon + 「{count}人」表示
  - テキスト色: 濃い青（#1976d2）
- **ガール人数**: left: '450px', width: '60px'
  - WomanIcon + 「{count}人」表示
  - テキスト色: ピンク（#e91e63）

##### 10. 新規追加機能
- **追加ボタン**: 右上配置、「+ 新規追加」ラベル
- **AddRecordDialog統合**: 詳細ビューと同じダイアログコンポーネント使用
- **バリデーション**: イベント開催日選択必須、その他任意

##### 11. 状態管理
- **編集状態**: editingRecord, hoveredRow
- **ポップアップ状態**: 各種ポップアップ管理
- **コンテキストメニュー**: contextMenu状態
- **削除確認**: deleteConfirm状態  
- **詳細ドロワー**: detailDrawer状態
- **新規追加**: addRecordDialog状態

##### 12. インタラクション仕様
- **ホバー効果**: 行全体のホバー時背景色変更（#f5f5f5）
- **編集モード**: 背景色変更（#fff3e0）、操作要素の強調表示
- **クリック操作**: 編集モード時のみ各要素クリック可能
- **キーボード操作**: 編集完了時のEnterキー対応

##### 13. パフォーマンス最適化
- **レンダリング最適化**: React.memo適用検討
- **状態更新**: イミュータブルな更新パターン使用
- **イベント処理**: 適切なイベントハンドラーの設定

##### 14. アクセシビリティ対応
- **キーボード操作**: Tab順序の適切な設定
- **スクリーンリーダー**: aria-label、role属性の適切な設定
- **色覚多様性**: 色のみに依存しない情報伝達

##### 15. エラーハンドリング
- **バリデーション**: 入力値の適切な検証
- **エラー表示**: 統一されたエラーメッセージ形式
- **フォールバック**: データ読み込み失敗時の適切な表示

##### 9. データ型定義（更新版）
```typescript
interface SalesRecord {
  id: number;
  assignedUser: string;
  updatedUser: string;
  status: '起票' | '連絡前' | '連絡済' | '連絡不要' | 'お断り';
  agency: string;
  detailStatus: '未登録' | '公開済み';
  schedule: boolean[]; // 7日分のスケジュール（火曜日スタート）
  dayType: '平日' | '週末';
  isBandProject: boolean;
  bandWorkDays?: number;
  eventLocation: string;
  managerName: string;
  managerPhone: string;
  hostStore: string;
  partnerStores: string[]; // 配列に変更（複数店舗対応）
  flags: {
    hasLocationReservation: boolean;
    isExternalVenue: boolean;
    hasBusinessTrip: boolean;
  };
  quotaTable: {
    closer: { count: number; unitPrice: number; transportFee: number; };
    girl: { count: number; unitPrice: number; transportFee: number; };
  };
  freeEntry: { [day: string]: number | undefined };
  locationReservations?: { // 配列に変更（複数レコード対応）
    id: string;
    date: string;
    status: '申請中' | '日程NG' | '通信NG' | '代理店確認中' | '確定'; // ステータス更新
    arrangementCompany: string;
    wholesalePrice: number;
    purchasePrice: number;
  }[];
  memo: string;
  selectedEventDates: string[]; // 追加：選択されたイベント開催日
}

interface NewRecordForm {
  assignedUser: string;
  agency: string;
  detailStatus: '未登録' | '公開済み';
  dayType: '平日' | '週末';
  isBandProject: boolean;
  bandWorkDays: number;
  eventLocation: string;
  managerName: string;
  managerPhone: string;
  hostStore: string;
  partnerStores: string[];
  hasLocationReservation: boolean;
  locationReservationDetails: {
    id: string;
    date: string;
    status: '申請中' | '日程NG' | '通信NG' | '代理店確認中' | '確定';
    arrangementCompany: string;
    wholesalePrice: number;
    purchasePrice: number;
  }[];
  isExternalVenue: boolean;
  hasBusinessTrip: boolean;
  closerCount: number;
  closerUnitPrice: number;
  closerTransportFee: number;
  girlCount: number;
  girlUnitPrice: number;
  girlTransportFee: number;
  selectedEventDates: string[];
}
```

##### 10. 最新デザイン要件（2024年実装版）

###### **レイアウト・サイズ調整**
- **テーブル全体**: `minWidth: 2000px`で横スクロール対応
- **レコード行高**: 固定150px
- **詳細エリア**: 幅1200px、3列構成（左列200px、中央列350px、右列200px）
- **ヘッダー**: 固定ヘッダー、項目名改行防止のため列幅調整済み

###### **列幅設定**
- 編集アイコン: 30px
- 担当者: 80px
- 更新者: 80px  
- ステータス: 90px
- 代理店: 100px
- 詳細情報: 80px
- 日付列（各）: 30px
- 曜日: 70px
- 帯案件: 80px

###### **色彩設計**
- **土曜日**: 青系背景（#e3f2fd）、青色テキスト（#1976d2）
- **日曜日**: 赤系背景（#ffebee）、赤色テキスト（#d32f2f）
- **曜日列セル色**:
  - 平日: 薄いグレー（#f5f5f5）
  - 週末: 薄い黄色（#fff9c4）

###### **代理店ラベル色分け**
- **ピーアップ**: ティール系（#e0f2f1背景、#00796b文字）
- **ラネット**: パープル系（#f3e5f5背景、#7b1fa2文字）
- **CS**: グリーン系（#e8f5e9背景、#2e7d32文字）
- **エージェントA**: オレンジ系（#fff3e0背景、#ef6c00文字）
- **マーケティング会社B**: ブルー系（#e3f2fd背景、#1976d2文字）

###### **詳細エリア左列デザイン**
- **イベント実施場所**: フォントサイズ1.3rem、太字
- **担当MG**: 通常テキスト（名前・電話番号）
- **開催店舗**: 青色角丸ラベル（#2196f3背景、白文字）
- **連名店舗**: グレー角丸ラベル（#e0e0e0背景、#666666文字）
- **フラグ**: アイコン+テキスト形式
  - 場所取り: 緑色（#4caf50）+ LocationIcon
  - 外現場: オレンジ色（#ff9800）+ BusinessIcon  
  - 出張: 青色（#2196f3）+ FlagIcon
- **要素間余白**: 各要素間に適切な余白（mb: 1〜1.5）

###### **枠集計表デザイン**
- **表構造**: 役割・人数・単価・交通費・売上の5列
- **行構成**: ヘッダー + クローザー行 + ガール行
- **セルパディング**: 8px（行高を高めに設定）
- **フォントサイズ**: 0.75rem
- **数値右揃え**: 単価・交通費・売上列
- **役割色分け**: クローザー（#1976d2）、ガール（#e91e63）

###### **無料入店デザイン**
- **レイアウト**: 左端ラベル + 横並びデータ
- **ラベル位置**: 中央揃え（alignItems: center）
- **日付表示**: 稼働日に連動（1/{日付}形式）
- **フォントサイズ**: 日付0.65rem（小）、人数0.9rem（大）
- **日付色**: #666（薄いグレー）

###### **営業担当メモ**
- **高さ**: レコード行いっぱい（150px）
- **背景色**: #fafafa
- **枠線**: 1px solid #e0e0e0、角丸4px

###### **インタラクション機能**
- **編集アイコン**: マウスオーバー時に表示・強調
- **担当者列**: クリックでポップアップ選択（田中、佐藤、鈴木、高橋、渡辺、伊藤、山本、中村）
- **ステータス列**: クリックでポップアップ選択（起票、連絡前、連絡済、連絡不要、お断り）
- **場所取りチップ**: クリックでツールチップ詳細表示
- **ポップアップ**: 120px幅、クリック位置に表示、透明背景

###### **詳細情報列**
- **ステータスチップ**: 未登録（グレー）、公開済み（緑）
- **詳細情報ボタン**: 「詳細情報」テキスト、縦並び配置

### 非機能要件
- レスポンシブデザイン（デスクトップファースト）
- 直感的なUI/UX
- リアルタイム更新対応
- データの整合性保持

## 🏗️ Tech Stack（言語／FW／DB／インフラ）

### フロントエンド
- **Framework**: Next.js 13.5.6
- **Language**: TypeScript
- **UI Library**: Material-UI (MUI)
- **Styling**: Material-UI sx prop, CSS-in-JS

### バックエンド
- **Runtime**: Node.js
- **API**: Next.js API Routes

### 開発環境
- **Package Manager**: npm
- **Dev Server**: Next.js dev server (port 3000)
- **Linting**: ESLint, TypeScript

## 🎨 Design System（カラースケール・アイコン統一ルール）

### カラーパレット

#### ステータス系カラー
- **起票**: `#e3f2fd` (背景) / `#1976d2` (テキスト) - ブルー系
- **進行中・連絡前**: `#f5f5f5` (背景) / `#666666` (テキスト) - グレー系
- **完了・連絡済**: `#e8f5e9` (背景) / `#2e7d32` (テキスト) - グリーン系
- **注意・連絡不要**: `#fff3e0` (背景) / `#ef6c00` (テキスト) - オレンジ系
- **エラー・お断り**: `#ffebee` (背景) / `#d32f2f` (テキスト) - レッド系

#### 役割系カラー
- **クローザー**: `#1976d2` (プライマリブルー) / `#2196f3` (セカンダリブルー)
- **ガール**: `#e91e63` (ピンク) / `#f50057` (セカンダリピンク)
- **無料入店**: `#4caf50` (グリーン)

#### 代理店系カラー
- **ピーアップ**: `#e0f2f1` (背景) / `#00796b` (テキスト) - ティール系
- **ラネット**: `#f3e5f5` (背景) / `#7b1fa2` (テキスト) - パープル系
- **CS**: `#e8f5e9` (背景) / `#2e7d32` (テキスト) - グリーン系

#### 機能系カラー
- **場所取り**: `#1976d2` (プライマリブルー)
- **外現場**: `#4caf50` (グリーン)
- **出張**: `#ff9800` (オレンジ)

### アイコン統一ルール

#### 人物・役割系アイコン
- **クローザー**: `PersonIcon` - 人物アイコン
- **ガール**: `WomanIcon` - 女性アイコン（カード表示）/ `FaceIcon`
- **管理者・担当者**: `AccountCircleIcon` - アカウントアイコン

#### 機能・操作系アイコン
- **場所取り**: `LocationOnIcon` - 場所アイコン
- **外現場**: `BusinessIcon` - ビジネスアイコン
- **出張**: `FlagIcon` - フラグアイコン
- **編集**: `EditIcon` - 編集アイコン
- **削除**: `DeleteIcon` - 削除アイコン
- **追加**: `AddIcon` - 追加アイコン
- **閉じる**: `CloseIcon` - 閉じるアイコン
- **確認**: `CheckIcon` - チェックアイコン

#### 状態表示アイコン
- **完了・確定**: `CheckCircleIcon` - チェック円アイコン
- **進行中**: `PendingIcon` - 保留アイコン
- **エラー・NG**: `ErrorIcon` - エラーアイコン
- **警告**: `WarningIcon` - 警告アイコン

### フォント・タイポグラフィ

#### フォントサイズ階層
- **大見出し**: 1.5rem (24px) - ページタイトル
- **中見出し**: 1.3rem (20.8px) - セクションタイトル
- **小見出し**: 1rem (16px) - サブセクション
- **本文**: 0.875rem (14px) - 通常テキスト
- **小文字**: 0.75rem (12px) - 補助情報
- **極小文字**: 0.65rem (10.4px) - 日付等の詳細

#### フォントウェイト
- **太字**: 700 (bold) - 重要項目
- **中太**: 600 (semibold) - 見出し
- **標準**: 400 (normal) - 通常テキスト
- **細字**: 300 (light) - 補助テキスト

### 余白・レイアウト統一ルール

#### 余白階層
- **極小**: 4px (0.5rem) - 要素間の最小間隔
- **小**: 8px (1rem) - 関連要素間
- **中**: 16px (2rem) - セクション内の間隔
- **大**: 24px (3rem) - セクション間の間隔
- **極大**: 32px (4rem) - ページレベルの間隔

#### ボーダー・角丸
- **標準角丸**: 4px - 一般的な要素
- **大角丸**: 8px - カード・ダイアログ
- **ボーダー幅**: 1px - 標準的な境界線
- **強調ボーダー**: 2px - 重要な境界線

## 🚫 禁止事項

### 技術的禁止事項
- **直接DOM操作**: React/Next.jsの仕組みを無視した`document.getElementById`等の使用禁止
- **インラインスタイル**: `style`属性の使用禁止（Material-UI `sx` prop使用必須）
- **型安全性の無視**: `any`型の使用禁止（適切な型定義必須）
- **外部CDN依存**: セキュリティリスクがあるCDNライブラリの直接読み込み禁止

### UI/UX禁止事項
- **一貫性の破綻**: 既存のデザインシステムを無視した独自スタイルの適用禁止
- **アクセシビリティ軽視**: キーボード操作・スクリーンリーダー対応を無視した実装禁止
- **レスポンシブ破綻**: モバイル・タブレットでのレイアウト崩れを引き起こす固定幅指定禁止
- **色覚多様性無視**: 色のみに依存した情報伝達方法の禁止

### データ・状態管理禁止事項
- **直接状態変更**: React state の直接変更（イミュータブルな更新必須）
- **サイドエフェクトの乱用**: useEffect内での無制限な副作用実行禁止
- **メモリリーク**: イベントリスナーやタイマーのクリーンアップ漏れ禁止
- **無限再レンダリング**: 依存配列の不適切な設定による無限ループ禁止

### セキュリティ禁止事項
- **XSS脆弱性**: ユーザー入力の未サニタイズでのHTML出力禁止
- **機密情報露出**: APIキー、パスワード等のフロントエンド埋め込み禁止
- **CSRF対策漏れ**: 状態変更を伴うAPI呼び出しでのCSRF対策省略禁止

### パフォーマンス禁止事項
- **不要な再レンダリング**: React.memo、useMemo、useCallbackの適切な使用なしでの重い計算禁止
- **大容量データの一括読み込み**: ページネーション・仮想化なしでの大量データ表示禁止
- **未最適化画像**: WebP対応・レスポンシブ画像なしでの大容量画像使用禁止

## 📋 実装ガイドライン

### コンポーネント設計原則

#### Atomic Design適用
- **Atoms**: Button、Input、Icon等の最小単位
- **Molecules**: SearchBox、DatePicker等の機能単位
- **Organisms**: Header、Table、Form等の複合機能
- **Templates**: ページレイアウトの骨格
- **Pages**: 具体的なページ実装

#### コンポーネント命名規則
- **ファイル名**: PascalCase (例: `SalesTable.tsx`)
- **コンポーネント名**: PascalCase (例: `SalesTable`)
- **Props インターフェース**: `{ComponentName}Props` (例: `SalesTableProps`)
- **フォルダ構造**: feature-based (例: `src/components/sales/`)

### 状態管理ガイドライン

#### Local State (useState)
- 単一コンポーネント内の状態
- フォーム入力値
- UI表示状態（モーダル開閉等）

#### Context API
- 複数コンポーネント間での状態共有
- テーマ設定
- ユーザー認証状態

#### Custom Hooks
- 状態ロジックの再利用
- API呼び出しロジック
- 複雑なビジネスロジック

### API設計ガイドライン

#### RESTful設計
- `GET /api/sales` - 案件一覧取得
- `POST /api/sales` - 案件新規作成
- `PUT /api/sales/:id` - 案件更新
- `DELETE /api/sales/:id` - 案件削除

#### レスポンス形式統一
```typescript
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: {
    code: string;
    message: string;
  };
  meta?: {
    total: number;
    page: number;
    limit: number;
  };
}
```

#### エラーハンドリング
- HTTP ステータスコードの適切な使用
- フロントエンドでの統一的エラー表示
- ログ出力とエラー追跡

### テスト戦略

#### 単体テスト
- Jest + React Testing Library
- コンポーネントの振る舞いテスト
- カスタムフックのテスト
- カバレッジ80%以上維持

#### 統合テスト
- API エンドポイントのテスト
- ページ全体の動作テスト
- ユーザーシナリオベースのテスト

#### E2Eテスト
- Playwright を使用
- 重要なユーザーフローのテスト
- ブラウザ互換性テスト

### デプロイメント・環境管理

#### 環境分離
- **Development**: `localhost:3000`
- **Staging**: 本番同等環境でのテスト
- **Production**: 本番環境

#### CI/CD パイプライン
1. コードプッシュ
2. リント・型チェック
3. 単体テスト実行
4. ビルド確認
5. E2Eテスト実行
6. デプロイ実行

#### 環境変数管理
- `.env.local` - ローカル開発用
- `.env.staging` - ステージング用
- `.env.production` - 本番用
- 機密情報は環境変数で管理（コードに含めない）

## 📊 品質基準

### コード品質
- **TypeScript Strict Mode**: 有効化必須
- **ESLint**: 警告0件維持
- **Prettier**: 自動フォーマット適用
- **Husky**: コミット前のリント・テスト実行

### パフォーマンス基準
- **First Contentful Paint**: 1.5秒以内
- **Largest Contentful Paint**: 2.5秒以内
- **Cumulative Layout Shift**: 0.1以下
- **Bundle Size**: 500KB以下（gzip圧縮後）

### アクセシビリティ基準
- **WCAG 2.1 AA準拠**: 最低基準
- **キーボード操作**: 全機能対応
- **スクリーンリーダー**: 適切な読み上げ対応
- **色覚多様性**: 色のみに依存しない情報伝達

### セキュリティ基準
- **HTTPS**: 本番環境必須
- **CSP (Content Security Policy)**: 適用
- **入力値検証**: フロント・バックエンド両方で実施
- **認証・認可**: 適切なアクセス制御

---

**最終更新**: 2024年12月
**バージョン**: 1.0
**作成者**: 案件管理システム開発チーム