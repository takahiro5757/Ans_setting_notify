# 1. 画面名

---

**ユーザー情報（User Profile Settings）**

---

# 2. 要素別仕様

---

## 2-1. 基本情報セクション

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 氏名 | TextField | 入力 | ユーザーの氏名（必須） |
| 氏名カナ | TextField | 入力 | ユーザーの氏名カナ（必須） |
| メールアドレス | TextField | 入力 | ログイン用メールアドレス（必須、一意制約） |
| 電話番号 | TextField | 入力 | 連絡先電話番号 |
| 所属部署 | TextField | 入力 | 所属部署名 |
| 役職 | TextField | 入力 | 現在の役職 |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| 氏名変更 | 入力時 | 氏名の更新 | 同画面 | 必須チェック、文字数制限（50文字） |
| 氏名カナ変更 | 入力時 | 氏名カナの更新 | 同画面 | 必須チェック、カタカナチェック |
| メール変更 | 入力時 | メールアドレスの更新 | 同画面 | 必須チェック、形式チェック、重複チェック |
| 電話番号変更 | 入力時 | 電話番号の更新 | 同画面 | 形式チェック（ハイフンあり・なし両対応） |
| 所属部署変更 | 入力時 | 所属部署の更新 | 同画面 | 文字数制限（30文字） |
| 役職変更 | 入力時 | 役職の更新 | 同画面 | 文字数制限（30文字） |

---

## 2-2. パスワード変更セクション

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 現在のパスワード | TextField | 入力 | 現在のパスワード（必須、type="password"） |
| 新しいパスワード | TextField | 入力 | 新しいパスワード（必須、type="password"） |
| パスワード確認 | TextField | 入力 | 新しいパスワードの確認入力（必須、type="password"） |
| パスワード強度インジケーター | LinearProgress | 出力 | パスワード強度を色分けで表示 |
| パスワード表示切り替え | IconButton | 入力 | パスワードの表示・非表示切り替え |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| 現在パスワード入力 | 入力時 | 現在のパスワード認証 | 同画面 | 必須チェック |
| 新パスワード入力 | 入力時 | 新しいパスワードの設定 | 同画面 | 強度チェック（8文字以上、英数字記号含む） |
| パスワード確認入力 | 入力時 | パスワード一致確認 | 同画面 | 新パスワードとの一致チェック |
| 表示切り替え | アイコンクリック | パスワードの表示・非表示切り替え | 同画面 | なし |

---

## 2-3. 通知設定セクション

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| メール通知 | Switch | 入力 | メール通知の有効・無効切り替え |
| プッシュ通知 | Switch | 入力 | ブラウザプッシュ通知の有効・無効切り替え |
| LINE通知 | Switch | 入力 | LINE通知の有効・無効切り替え |
| 通知タイミング設定 | FormGroup | 入力 | 通知を受け取るタイミングの選択 |
| 案件更新通知 | Checkbox | 入力 | 案件更新時の通知設定 |
| シフト変更通知 | Checkbox | 入力 | シフト変更時の通知設定 |
| 請求関連通知 | Checkbox | 入力 | 請求関連の通知設定 |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| メール通知切り替え | スイッチ操作 | メール通知設定の変更 | 同画面 | なし |
| プッシュ通知切り替え | スイッチ操作 | プッシュ通知設定の変更 | 同画面 | ブラウザ権限チェック |
| LINE通知切り替え | スイッチ操作 | LINE通知設定の変更 | 同画面 | LINE連携状態チェック |
| 通知タイミング変更 | チェックボックス操作 | 通知タイミングの変更 | 同画面 | 最低1つは選択必須 |

---

## 2-4. セキュリティ設定セクション

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 二段階認証 | Switch | 入力 | 二段階認証の有効・無効切り替え |
| 認証アプリ設定 | Button | 入力 | Google Authenticator等の設定 |
| バックアップコード | Button | 入力 | バックアップコードの生成・表示 |
| ログイン履歴 | Table | 出力 | 最近のログイン履歴を表示 |
| セッション管理 | List | 出力 | アクティブなセッション一覧 |
| セッション終了ボタン | IconButton | 入力 | 個別セッションの強制終了 |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| 二段階認証有効化 | スイッチ操作 | 二段階認証の設定開始 | 設定ダイアログ | パスワード再確認 |
| 認証アプリ設定 | ボタンクリック | QRコード表示とアプリ連携 | 設定ダイアログ | なし |
| バックアップコード生成 | ボタンクリック | 緊急用バックアップコード生成 | コード表示ダイアログ | 二段階認証有効時のみ |
| セッション終了 | 終了ボタンクリック | 指定セッションの強制終了 | 同画面 | 確認ダイアログ |

---

## 2-5. アクションボタンセクション

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 保存ボタン | Button | 入力 | 変更内容を保存（variant="contained"） |
| キャンセルボタン | Button | 入力 | 変更をキャンセルして元に戻す（variant="outlined"） |
| リセットボタン | Button | 入力 | フォームを初期状態にリセット |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| 保存実行 | 保存ボタンクリック | 全ての変更内容をサーバーに保存 | 同画面 | 全フィールドバリデーション |
| キャンセル実行 | キャンセルボタンクリック | 変更をキャンセルして初期値に戻す | 同画面 | 変更確認ダイアログ |
| リセット実行 | リセットボタンクリック | フォームを初期状態にリセット | 同画面 | 確認ダイアログ |

---

## 3. データ仕様

### 3.1 ユーザープロフィールデータ

```typescript
interface UserProfile {
  id: string;
  name: string;           // 氏名
  nameKana: string;       // 氏名カナ
  email: string;          // メールアドレス
  phone?: string;         // 電話番号
  department?: string;    // 所属部署
  position?: string;      // 役職
  createdAt: Date;        // 作成日時
  updatedAt: Date;        // 更新日時
}
```

### 3.2 通知設定データ

```typescript
interface NotificationSettings {
  userId: string;
  email: boolean;           // メール通知
  push: boolean;            // プッシュ通知
  line: boolean;            // LINE通知
  projectUpdate: boolean;   // 案件更新通知
  shiftChange: boolean;     // シフト変更通知
  billing: boolean;         // 請求関連通知
}
```

### 3.3 セキュリティ設定データ

```typescript
interface SecuritySettings {
  userId: string;
  twoFactorEnabled: boolean;    // 二段階認証
  backupCodes: string[];        // バックアップコード
  lastPasswordChange: Date;     // パスワード最終変更日
}
```

---

## 4. バリデーション仕様

### 4.1 基本情報バリデーション

| フィールド | 必須 | 最大文字数 | 形式チェック | 重複チェック |
| --- | --- | --- | --- | --- |
| 氏名 | ✅ | 50 | - | - |
| 氏名カナ | ✅ | 50 | カタカナのみ | - |
| メールアドレス | ✅ | 100 | Email形式 | ✅ |
| 電話番号 | - | 15 | 電話番号形式 | - |
| 所属部署 | - | 30 | - | - |
| 役職 | - | 30 | - | - |

### 4.2 パスワードバリデーション

- **最小文字数**: 8文字以上
- **文字種類**: 英大文字・小文字・数字・記号を含む
- **禁止パターン**: 辞書攻撃対策、連続文字禁止
- **履歴チェック**: 過去5回のパスワードと同じものは禁止

---

## 5. エラーハンドリング

### 5.1 バリデーションエラー

- **リアルタイムバリデーション**: 入力中にエラー表示
- **フィールド下エラー**: 該当フィールドの下に赤色でエラーメッセージ
- **フォーム送信時エラー**: 全体的なエラーサマリーを上部に表示

### 5.2 通信エラー

- **保存失敗**: 「保存に失敗しました。再度お試しください。」
- **認証エラー**: 「認証に失敗しました。再度ログインしてください。」
- **ネットワークエラー**: 「ネットワークエラーが発生しました。」

### 5.3 権限エラー

- **アクセス拒否**: 「この機能を利用する権限がありません。」
- **編集禁止**: 「この項目は編集できません。」

---

## 6. セキュリティ考慮事項

### 6.1 個人情報保護

- **データ暗号化**: 保存時・通信時の暗号化
- **アクセスログ**: 個人情報アクセスのログ記録
- **データ削除**: 退職時等の個人情報完全削除

### 6.2 認証・認可

- **セッション管理**: 適切なタイムアウト設定
- **CSRF対策**: CSRFトークンによる攻撃防止
- **XSS対策**: 入力値のサニタイズ

### 6.3 監査機能

- **変更履歴**: プロフィール変更の履歴管理
- **ログイン履歴**: 不正アクセス検知のための履歴保存
- **セキュリティイベント**: 異常なアクセスパターンの検知
