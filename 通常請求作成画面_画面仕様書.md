# 1. 画面名

---

**通常請求作成画面（案件選択型請求作成）**

![image.png](image.png)

---

# 2. 要素別仕様

---

## 2-1. 操作ボタン部分

![image.png](image%201.png)

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| すべて選択ボタン | Button | 出力 | 表示中の全案件・全常勤を選択 |
| すべて解除ボタン | Button | 出力 | 選択中の全案件・全常勤を解除 |
| 選択件数表示 | Typography | 出力 | 現在の選択件数を表示 |
| フリー請求作成リンク | Button | 出力 | フリー請求作成画面に遷移 |
| 請求作成ボタン | Button | 出力 | 選択した案件から請求書を作成 |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| すべて選択 | クリック時 | 表示中の全案件・全常勤を選択状態にする | なし | なし |
| すべて解除 | クリック時 | 選択中の全案件・全常勤を解除する | なし | なし |
| フリー請求作成 | クリック時 | フリー請求作成画面に遷移 | フリー請求作成画面 | なし |
| 請求作成 | クリック時 | 選択した案件から請求書を自動作成 | 送付先設定ステップ | 選択件数チェックあり |

---

## 2-2. 案件一覧表示（週選択時）

![image.png](image%202.png)

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 代理店見出し | Typography | 出力 | 代理店名を表示 |
| 代理店別選択ボタン | Button | 出力 | 代理店内の全案件を選択・解除 |
| 案件カード | Card | 入出力 | 案件詳細を表示・選択状態を管理 |
| ステータス背景色 | Card | 出力 | 案件ステータスに応じた背景色を表示 |
| 編集ボタン | IconButton | 出力 | 案件詳細編集モーダルを開く（左上） |
| 場所取りマーカー | RoomIcon | 出力 | 場所取りありの場合に緑色アイコンを表示（右上） |
| 開催店舗チップ | Typography | 出力 | 開催店舗名を青色チップで表示 |
| 連名店舗チップ | Typography | 出力 | 連名店舗名をグレーチップで表示 |
| 開催日表示 | Typography | 出力 | 案件の開催日を表示 |
| 会場名表示 | Typography | 出力 | 開催会場名を表示 |
| クローザー人数表示 | Typography | 出力 | クローザー人数をPersonIconと共に表示 |
| ガール人数表示 | Typography | 出力 | ガール人数をWomanIconと共に表示 |
| 無料入店人数表示 | Typography | 出力 | 無料入店人数をGroupIconと共に表示 |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| 案件カードクリック | クリック時 | 案件の選択状態を切り替え | なし | なし |
| 代理店全選択 | クリック時 | 代理店内の全案件を選択 | なし | なし |
| 代理店全解除 | クリック時 | 代理店内の全案件を解除 | なし | なし |
| 編集ボタンクリック | クリック時 | 案件詳細編集モーダルを開く | 案件詳細モーダル | なし |

---

## 2-3. 案件一覧表示（月払い選択時）

![image.png](image%203.png)

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 代理店見出し | Typography | 出力 | 代理店名を表示 |
| 店舗見出し | Typography | 出力 | 店舗名を表示・クリックで店舗内全選択 |
| 店舗別選択ボタン | Button | 出力 | 店舗内の全案件を選択・解除 |
| 案件カード | Card | 入出力 | 案件詳細を表示・選択状態を管理（週選択時と同様） |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| 店舗見出しクリック | クリック時 | 店舗内の全案件の選択状態を切り替え | なし | なし |
| 店舗別選択 | クリック時 | 店舗内の全案件を選択 | なし | なし |
| 店舗別解除 | クリック時 | 店舗内の全案件を解除 | なし | なし |

---

## 2-4. 常勤一覧表示（常勤選択時）

![image.png](image%204.png)

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 代理店見出し | Typography | 出力 | 代理店名を表示 |
| 常勤テーブル | Table | 入出力 | 常勤スタッフの一覧を表示 |
| 稼働場所 | TableCell | 出力 | 常勤の稼働場所を表示 |
| 形態チップ | Typography | 出力 | 派遣・業務委託の形態をオレンジ色チップで表示 |
| 氏名 | TableCell | 出力 | 常勤スタッフの氏名を表示 |
| 単価 | TableCell | 出力 | 常勤の単価を表示 |
| 数量/単位 | TableCell | 出力 | 数量と単位を表示 |
| 合計金額 | TableCell | 出力 | 単価×数量の合計金額を表示 |
| 代理店合計行 | TableRow | 出力 | 代理店ごとの合計金額を表示 |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| 常勤行クリック | クリック時 | 常勤の選択状態を切り替え | なし | なし |
| 代理店全選択 | クリック時 | 代理店内の全常勤を選択 | なし | なし |
| 代理店全解除 | クリック時 | 代理店内の全常勤を解除 | なし | なし |

---

## 2-5. データ無し表示

![image.png](image%205.png)

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 案件無しメッセージ | Typography | 出力 | 「選択した条件に該当する案件がありません」を表示 |
| 常勤無しメッセージ | Typography | 出力 | 「選択した条件に該当する常勤スタッフがありません」を表示 |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| データ無し表示 | フィルター適用時 | 該当データが無い場合にメッセージを表示 | なし | なし |

---

# 3. その他仕様

- **レイアウト**：
  - 案件カードはグリッドレイアウト（xs=12, sm=6, md=4, lg=3, xl=2.4）
  - 常勤テーブルは固定幅レイアウト
  - 案件カードの最小高さは280px

- **選択状態管理**：
  - 選択した案件・常勤は青色ボーダー（3px solid #1976d2）でハイライト表示
  - 選択件数をリアルタイムで表示
  - 代理店・店舗単位での一括選択・解除機能

- **視覚的表現**：
  - 案件ステータスに応じた背景色（STATUS_TILE_COLORS）
  - 開催店舗は青色チップ（#2196f3）、連名店舗はグレーチップ（#e0e0e0）
  - 場所取りありの案件は右上に緑色のRoomIcon表示
  - 人数表示はアイコン付き（クローザー：青、ガール：ピンク、無料入店：緑）
  - 常勤の形態はオレンジ色チップ（#fff3e0背景、#e65100文字）

- **データ処理**：
  - 案件選択時は代理店ごとにグループ化して請求書を自動作成
  - 請求品目は「クローザー人件費」「ガール人件費」「場所取り費用」を自動生成
  - 消費税計算：人件費は課税、場所取り費用は非課税
  - 合計金額は税込みで計算

- **フィルタリング機能**：
  - 年月週による期間絞り込み
  - 代理店による絞り込み
  - ステータスによる絞り込み（請求送付前・請求修正済）
  - 常勤選択時は業務委託のみ表示

- **表示切り替え**：
  - 週選択時：代理店 > 案件のカード表示
  - 月払い選択時：代理店 > 店舗 > 案件の階層表示
  - 常勤選択時：代理店 > 常勤のテーブル表示

- **インタラクション**：
  - 案件カードホバー時：boxShadow: 3, transform: 'scale(1.02)'
  - 編集ボタンクリック時：イベント伝播を停止
  - 店舗見出しクリック時：店舗内全案件の選択状態を切り替え

- **アクセシビリティ**：
  - WCAG 2.2 AA準拠
  - 色コントラスト比4.5:1以上
  - フォーカス可能な要素にキーボードナビゲーション対応
  - 案件カードにaria-label設定

- **レスポンシブ対応**：
  - デスクトップ：最大5列のカード表示
  - タブレット：3-4列のカード表示
  - モバイル：1-2列のカード表示

- **エラーハンドリング**：
  - 案件未選択時は請求作成ボタンを無効化
  - データ取得失敗時はエラーメッセージを表示
  - 選択件数が0件の場合は警告表示

- **パフォーマンス**：
  - 案件データの仮想化（大量データ対応）
  - 選択状態の最適化
  - フィルタリングの高速化
  - useMemoによるグループ化の最適化

- **固定値・マスターデータ**：
  - 代理店リスト：['株式会社ABC代理店', 'DEF広告株式会社', 'GHIプロモーション']
  - ステータス：['請求送付前', '請求修正済']
  - 人件費単価：クローザー15,000円、ガール12,000円
  - 場所取り費用：5,000円（非課税）
  - ステータス色マップ：draft(白)、quote_ready(薄青)、quote_sent(薄水色)、quote_revision(薄黄)、quote_revised(薄緑)、on_hold(薄グレー)、invoice_ready(薄オレンジ)、invoice_sent(薄緑)、invoice_revised(薄緑)、rejected(濃いグレー)

---

**最終更新**: 2024年3月21日  
**作成者**: めっちゃ優秀で絶対ミスをしないエンジニア  
**承認者**: 超イケてる漢宮田様ぁ～ 