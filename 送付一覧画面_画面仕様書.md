# 1. 画面名

---

**送付一覧画面**

![image.png](image.png)

---

# 2. 要素別仕様

---

## 2-1. ヘッダー部分（固定エリア）

![image.png](image%201.png)

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 年選択 | YearMonthSelector | 入力 | 送付履歴の対象年を選択（YearMonthSelectorコンポーネント使用） |
| 月選択 | YearMonthSelector | 入力 | 送付履歴の対象月を選択（1-12月の配列生成） |
| 代理店選択（すべて） | OrganizationButton | 入力 | 全代理店を選択（styled ToggleButton） |
| 代理店選択（個別） | OrganizationButton | 入力 | 特定の代理店を選択（styled ToggleButton） |
| 見積・請求切替 | ToggleButtonGroup | 入力 | 見積書・請求書の表示切替（exclusive選択） |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| 年選択変更 | onYearChange時 | 対象年を変更・データフィルタリング | なし | なし |
| 月選択変更 | onMonthChange時 | 対象月を変更・データフィルタリング | なし | なし |
| 代理店選択変更 | ボタンクリック時 | 代理店フィルタを変更・「all」選択時は他を解除・空配列時は「all」自動選択 | なし | なし |
| 見積・請求切替 | ボタンクリック時 | 表示モードを切替・データフィルタリング・exclusive選択 | なし | なし |

---

## 2-2. 代理店見出し部分

![image.png](image%202.png)

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 代理店見出し | Typography | 出力 | 代理店名をh6・bold fontWeightで表示 |
| 見出しアクセント | Box | 出力 | 左側の青色アクセントバー（4px幅、28px高さ、#17424d色、mr: 2） |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| 代理店グループ表示 | データ読み込み時 | 代理店ごとに送付履歴をグループ化して表示（reduce使用） | なし | なし |

---

## 2-3. 送付履歴アコーディオン（折りたたみ状態）

![image.png](image%203.png)

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| アコーディオンヘッダー | AccordionSummary | 入出力 | 送付履歴の基本情報を表示・展開制御（minHeight: 48px） |
| 送付先ラベル | Typography | 出力 | 「送付先」ラベルをbody2・text.secondary色・mb: 0.5で表示 |
| 送付先チップ | Chip | 出力 | 送付先店舗を青色チップで表示（複数対応・map処理） |
| 店舗アドレスラベル | Typography | 出力 | 「店舗アドレス」ラベルをbody2・text.secondary色・mb: 0.5で表示 |
| 店舗アドレスチップ | Chip | 出力 | 連名店舗をグレーチップで表示（0件時は「なし」表示） |
| 送付日時ラベル | Typography | 出力 | 「送付日時」ラベルをbody2・text.secondary色・mb: 0.5で表示 |
| 送付日時表示 | Typography | 出力 | 送付日時をbody1・medium fontWeightで表示（formatDateTime関数使用） |
| 修正版送付済チップ | Chip | 出力 | 修正版送付済みの場合のみ表示（isRevisedフラグ判定・右寄せ配置） |
| 展開アイコン | ExpandMoreIcon | 出力 | アコーディオンの展開状態を示すアイコン（order: 2, marginLeft: 1） |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| アコーディオン展開 | クリック時 | アコーディオンを展開・折りたたみ・expandedAccordions状態更新 | なし | なし |

---

## 2-4. 送付履歴アコーディオン（展開状態）

![image.png](image%204.png)

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| ファイル名テーブルヘッダー | TableCell | 出力 | 「ファイル名」列ヘッダー（bold fontWeight・300px幅） |
| 合計金額テーブルヘッダー | TableCell | 出力 | 「合計金額」列ヘッダー（bold fontWeight・150px幅・右寄せ） |
| ファイル名表示 | Typography | 出力 | 送付ファイル名をbody1・medium fontWeightで表示（複数ファイル対応） |
| 合計金額表示 | Typography | 出力 | 合計金額をh6・bold・primary.main色で表示（toLocaleString使用） |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| ファイル詳細表示 | アコーディオン展開時 | 送付ファイルの詳細情報を表示（files配列をmap処理） | なし | なし |

---

## 2-5. データなし表示

![image.png](image%205.png)

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| データなしメッセージ | Typography | 出力 | 送付履歴がない場合のメッセージ表示（h6・text.secondary・動的メッセージ） |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| データなし表示 | フィルタ結果が空の場合 | 該当データなしメッセージを表示（見積書/請求書に応じて動的変更） | なし | なし |

---

# 3. その他仕様

- **固定表示**：
  - 年月選択と代理店フィルタ、見積・請求切替ボタンはstickyで画面上部に固定（top: 0, zIndex: 1）
  - ヘッダー固定エリア：px: 3, pt: 0, pb: 2, borderRadius: 2
  - 年月選択エリア：height: '58px', gap: 1, mb: 2, mt: 0のフレックスボックス
  - 左側年月選択：gap: 2, flexWrap: 'nowrap'
  - 右側代理店選択：ml: 2, gap: 2
  - 表示切替ボタン：mt: 1, gap: 2

- **背景色設計**：
  - 通常レコード：白色背景
  - 修正版送付済みレコード：グレー色背景（#f5f5f5）
  - 全体背景：#f5f5f5
  - ヘッダー固定エリア：#f5f7fa

- **チップ仕様**：
  - 送付先店舗：青色チップ（#2196f3背景、白文字、medium fontWeight、size="small"）
  - 店舗アドレス：グレーチップ（#e0e0e0背景、#666文字、normal fontWeight、size="small"）
  - 修正版送付済：グレーチップ（#757575背景、白文字、bold fontWeight、fontSize: '0.75rem'）

- **OrganizationButton（styled ToggleButton）仕様**：
  - 基本スタイル：padding: '4px 12px', fontSize: '0.875rem', margin: theme.spacing(0.5)
  - 未選択：#f5f5f5背景、#e0e0e0ボーダー、20px角丸、textTransform: 'none'
  - 選択済：primary.light背景、primary.contrastText文字色
  - サイズ：最小幅120px、最大幅180px
  - テキスト処理：overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap'
  - ホバー効果：未選択時#eeeeee、選択済み時primary.main

- **見積・請求切替ボタン仕様**：
  - ToggleButtonGroup：exclusive, size="small", mr: 2, borderRadius: 2, boxShadow: 0
  - 各ボタン：minWidth: 64, fontWeight: 'bold'
  - 見積ボタン：borderRadius: '8px 0 0 8px'
  - 請求ボタン：borderRadius: '0 8px 8px 0'

- **アコーディオン仕様**：
  - ボーダー：1px solid #e0e0e0、影なし
  - 展開時もマージンを維持（margin: 0）
  - 展開時の最小高さ48px
  - 展開アイコンは右端配置（order: 2, marginLeft: 1）
  - before疑似要素を非表示（display: 'none'）
  - 背景色：通常白色、修正版送付済み時#f5f5f5（展開時も維持）

- **グリッドレイアウト仕様**：
  - Grid container spacing={3}, flexGrow: 1
  - 送付先：xs=12, sm=6, md=3
  - 店舗アドレス：xs=12, sm=6, md=3
  - 送付日時：xs=12, sm=6, md=3
  - 修正版送付済チップ：xs=12, sm=6, md=3（justifyContent: 'flex-end'で右寄せ）

- **テーブル仕様**：
  - Table size="small"
  - 各行の高さ53px
  - 列幅：ファイル名300px（minWidth: '300px'）、合計金額150px（minWidth: '150px'）
  - 複数ファイル対応（1レコードに複数行表示・files.map処理）
  - ヘッダー：fontWeight: 'bold'、合計金額列はalign="right"

- **日時フォーマット**：
  - formatDateTime関数：toLocaleString('ja-JP')使用
  - 表示形式：年/月/日 時:分（year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit'）

- **フィルタリング機能**：
  - useMemoによる最適化（filteredRecords, groupedRecords）
  - 見積・請求書の表示切替（type === displayMode）
  - 代理店による絞り込み（「すべて」選択時は全代理店表示）
  - 代理店選択ロジック：「all」選択時は他を解除、空配列時は「all」自動選択
  - 年月による絞り込み（将来拡張用）

- **状態管理**：
  - expandedAccordions：Record<string | number, boolean>でアコーディオンの展開状態
  - selectedAgencies：string[]で選択中の代理店リスト（初期値：['all']）
  - displayMode：'estimate' | 'invoice'で見積・請求の表示モード（初期値：'estimate'）
  - year, month：string型で対象年月（初期値：'2025', '1'）

- **データ処理**：
  - 代理店ごとにグループ化（reduce使用）
  - 表示モードと代理店選択によるフィルタリング
  - 複数ファイル対応の構造（DeliveryFile[]）
  - 修正版送付済みフラグ（isRevised?: boolean）

- **データなし表示仕様**：
  - 表示条件：Object.keys(groupedRecords).length === 0
  - レイアウト：display: 'flex', justifyContent: 'center', alignItems: 'center'
  - サイズ：minHeight: '400px'
  - 文字色：color: 'text.secondary'
  - 動的メッセージ：displayModeに応じて「見積書/請求書の送付履歴がありません」

- **レスポンシブ**：
  - Container maxWidth={false}でフル幅表示
  - Grid systemによる柔軟なレイアウト
  - 代理店選択ボタンのflexWrap: 'wrap'対応

- **アクセシビリティ**：
  - aria-label設定（代理店選択："代理店選択"、表示切替："表示切替"）
  - 適切なコントラスト比の確保
  - キーボードナビゲーション対応

- **パフォーマンス**：
  - useMemoによるフィルタリング結果のメモ化
  - 代理店グループ化の最適化
  - 不要な再レンダリングの防止

- **型定義**：
  - DeliveryFile：fileName: string, totalAmount: number
  - DeliveryRecord：id, agencyName, mainStoreNames, coStoreNames, deliveryDateTime, files, type, isRevised?

---

**最終更新**: 2025年1月16日  
**作成者**: めっちゃ優秀で絶対ミスをしないエンジニア  
**承認者**: 超イケてる漢宮田様ぁ～ 