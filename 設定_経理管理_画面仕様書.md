# 1. 画面名

---

**経理管理（Accounting Management）**

---

# 2. 要素別仕様

---

## 2-1. タブナビゲーション

### UI 要素・コントロール・I/O

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 基本設定タブ | Tab | 入力 | 会社基本情報設定 |
| メール設定タブ | Tab | 入力 | メール送信設定 |
| 文書設定タブ | Tab | 入力 | 見積書・請求書設定 |
| 経理ルールタブ | Tab | 入力 | 経理処理ルール設定 |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| タブ切り替え | タブクリック | 表示内容の切り替え | 各タブ画面 | 未保存データ確認 |

---

## 2-2. 基本設定タブ

### UI 要素・コントロール・I/O

#### 会社基本情報セクション

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 会社名 | TextField | 入力 | 会社名（必須）※メール変数${m_company}の値として使用 |
| 郵便番号 | TextField | 入力 | 会社所在地郵便番号（プレースホルダー：000-0000） |
| 会社住所 | TextField | 入力 | 会社所在地住所 |
| インボイス番号 | TextField | 入力 | インボイス番号（プレースホルダー：T－0000000000000） |
| 会社電話番号 | TextField | 入力 | 会社代表電話番号（プレースホルダー：03-0000-0000）※メール変数${m_tel}の値として使用 |
| 会社メールアドレス | TextField | 入力 | 会社代表メールアドレス（プレースホルダー：info@company.com）※メール変数${m_mail}の値として使用 |
| 会社URL | TextField | 入力 | 会社ウェブサイトURL（プレースホルダー：company.com）※メール変数${m_url}の値として使用 |
| 会社ロゴ | FileUpload | 入力 | 会社ロゴ画像のアップロード |
| ロゴプレビュー | Avatar | 出力 | アップロードしたロゴの表示（80x80px、角丸） |
| ロゴ変更ボタン | Button | 入力 | ロゴファイルの選択・変更 |
| ロゴ削除ボタン | Button | 入力 | ロゴの削除 |
| 編集ボタン/保存ボタン | Button | 入力 | 編集モード切替（編集時は「保存」、表示時は「編集」） |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| 編集開始 | 編集ボタンクリック | 会社情報編集モードの開始 | 同画面 | なし |
| ロゴアップロード | ロゴ変更ボタンクリック | 会社ロゴの画像アップロード | 同画面 | 画像形式チェック |
| ロゴ削除 | ロゴ削除ボタンクリック | 会社ロゴの削除 | 同画面 | 編集モード時のみ |
| 設定保存 | 保存ボタンクリック | 会社基本情報の保存 | 同画面 | 会社名必須チェック |

---

## 2-3. メール設定タブ

### UI 要素・コントロール・I/O

#### 見積書送付メールセクション

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 件名テンプレート | TextField | 入力 | 見積書メール件名のテンプレート（multiline） |
| 件名テンプレート表示 | Paper+Typography | 出力 | 件名テンプレートの表示（改行対応、単語分割） |
| 本文テンプレート | TextField | 入力 | 見積書メール本文のテンプレート（multiline、8行） |
| 本文テンプレート表示 | Paper+Typography | 出力 | 本文テンプレートの表示（改行保持、単語分割） |
| プレビューボタン | Button | 入力 | メールプレビューダイアログを開く（variant="outlined"、PreviewIcon付き） |
| 編集ボタン | IconButton | 入力 | テンプレートの編集開始 |
| 保存ボタン | IconButton | 入力 | テンプレートの保存 |
| リセットボタン | IconButton | 入力 | テンプレートの初期値復元 |

#### 請求書送付メールセクション

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 件名テンプレート | TextField | 入力 | 請求書メール件名のテンプレート（multiline） |
| 件名テンプレート表示 | Paper+Typography | 出力 | 件名テンプレートの表示（改行対応、単語分割） |
| 本文テンプレート | TextField | 入力 | 請求書メール本文のテンプレート（multiline、8行） |
| 本文テンプレート表示 | Paper+Typography | 出力 | 本文テンプレートの表示（改行保持、単語分割） |
| プレビューボタン | Button | 入力 | メールプレビューダイアログを開く（variant="outlined"、PreviewIcon付き） |
| 編集ボタン | IconButton | 入力 | テンプレートの編集開始 |
| 保存ボタン | IconButton | 入力 | テンプレートの保存 |
| リセットボタン | IconButton | 入力 | テンプレートの初期値復元 |

#### メールプレビューダイアログ

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| ダイアログタイトル | Typography | 出力 | 「見積書メールプレビュー」または「請求書メールプレビュー」 |
| 閉じるボタン | IconButton | 入力 | ダイアログを閉じる（×アイコン） |
| 件名セクション | Typography | 出力 | 「件名」ラベル（primary色） |
| 件名プレビュー | Paper+Typography | 出力 | 変数置換済み件名（monospace、lineHeight:1.2） |
| 本文セクション | Typography | 出力 | 「本文」ラベル（primary色） |
| 本文プレビュー | Paper+Typography | 出力 | 変数置換済み本文（monospace、lineHeight:1.2、改行対応） |
| 注意事項 | Alert | 出力 | プレビュー説明（info severity） |
| 閉じるボタン | Button | 入力 | ダイアログを閉じる（variant="outlined"） |

#### 利用可能な変数セクション

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 基本変数一覧 | Table | 出力 | メール作成用変数の表示（変数名35%、説明40%、例25%） |
| 箇条書き変数一覧 | Table | 出力 | 箇条書き変数の表示（変数名35%、説明40%、例25%） |

#### メールプレビューダイアログ

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| ダイアログタイトル | Typography | 出力 | 見積書/請求書送付メールプレビュー |
| プレビューアイコン | PreviewIcon | 出力 | プレビューを示すアイコン |
| 閉じるボタン | IconButton | 入力 | ダイアログを閉じる |
| 件名ラベル | Typography | 出力 | 件名セクションのラベル |
| 件名プレビュー | Paper+Typography | 出力 | 変数をサンプル値に置換した件名（monospace、lineHeight: 1.2） |
| 本文ラベル | Typography | 出力 | 本文セクションのラベル |
| 本文プレビュー | Paper+Typography | 出力 | 変数をサンプル値に置換した本文（monospace、lineHeight: 1.2） |
| 説明アラート | Alert | 出力 | 変数がサンプル値で表示されている旨の説明 |
| 閉じるボタン（下部） | Button | 入力 | ダイアログを閉じる |

#### 使用可能変数一覧

##### メール作成ルール変数

| 変数名 | 説明 | 例 |
| --- | --- | --- |
| ${yyyy,【加減】} | メール送信日の西暦年（加減可能） | 2024 |
| ${mm,【加減】} | メール送信日の月（2桁、加減可能） | 01 |
| ${dd,【加減】} | メール送信日の日（2桁、加減可能） | 15 |
| ${item} | 品目名をすべて挿入 | イオンモール上尾店 クローザー 3名 |
| ${c_company} | 取引先の会社名 | 株式会社ABC |
| ${c_name,0or1} | 担当者名（0:フルネーム、1:姓のみ）※ユーザー情報設定から取得 | 田中太郎 / 田中 |
| ${m_company} | 自社の会社名※会社基本設定から取得 | 株式会社ANSTEYPE |
| ${m_tel} | 自社の電話番号※会社基本設定から取得 | 048-123-4567 |
| ${m_mail} | 自社のメールアドレス※会社基本設定から取得 | info@ansteype.com |
| ${m_url} | 自社のURL※会社基本設定から取得 | ansteype.com |
| ${u_mail} | ユーザーのメールアドレス※ユーザー情報設定から取得 | user@sample-corp.com |
| ${/r} | 改行を挿入 | \n |
| ${space} | 空白文字を挿入 | 　 |

##### 箇条書き変数

| 変数名 | 説明 | 例 |
| --- | --- | --- |
| ${list,【値】,【リスト文字】} | 箇条書きを挿入 | ●項目1 |

#### 使用例

**メール宛先の例**:
```
${c_company}${space}${c_name,1}様${/r}
```
出力: ABC株式会社 田中様（改行）

**署名の例**:
```
------------------------${/r}
${m_company}${/r}
${c_name,0}${/r}
TEL：${m_tel}${/r}
EMAIL：${u_mail}${/r}
URL：${m_url}${/r}
------------------------
```
出力:
```
------------------------
株式会社ANSTEYPE
田中太郎
TEL：048-123-4567
EMAIL：tanaka@ansteype.com
URL：ansteype.com
------------------------
```

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| テンプレート編集開始 | 編集ボタンクリック | テンプレート編集モード切替 | 同画面 | なし |
| テンプレート保存 | 保存ボタンクリック | テンプレートの保存 | 同画面 | なし |
| テンプレートリセット | リセットボタンクリック | テンプレートの初期値復元 | 同画面 | なし |
| プレビュー表示 | プレビューボタンクリック | メールプレビューダイアログ表示 | プレビューダイアログ | なし |
| 変数置換処理 | プレビュー表示時 | 変数をサンプル値に置換 | プレビューダイアログ | なし |
| プレビュー閉じる | 閉じるボタンクリック | プレビューダイアログを閉じる | 同画面 | なし |
| 変数コピー | 変数名クリック | 変数をクリップボードにコピー | 同画面 | なし |
| テキスト改行表示 | テキスト表示時 | 長いテキストの自動改行処理 | 同画面 | なし |

---

## 2-4. 文書設定タブ

### UI 要素・コントロール・I/O

#### 見積書設定セクション

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| ファイル命名規則 | TextField | 入力 | 見積書ファイルの自動命名ルール（multiline対応） |
| ファイル命名規則表示 | Paper+Typography | 出力 | 命名規則の表示（monospace、改行対応、単語分割） |
| 番号発番ルール | TextField | 入力 | 見積書番号の自動生成パターン |
| 番号発番ルール表示 | Paper+Typography | 出力 | 発番ルールの表示（monospace、改行対応、単語分割） |
| 品目名記載ルール | TextField | 入力 | 品目欄の表示形式設定 |
| 品目名記載ルール表示 | Paper+Typography | 出力 | 記載ルールの表示（monospace、改行対応、単語分割） |
| 保存先URL | TextField | 入力 | ファイル保存先のURL設定（multiline、2行） |
| 保存先URL表示 | Paper+Typography | 出力 | 保存先URLの表示（monospace、改行対応、単語分割） |
| 編集ボタン | IconButton | 入力 | 設定項目の編集開始 |
| 保存ボタン | IconButton | 入力 | 設定内容の保存 |

#### 請求書設定セクション

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| ファイル命名規則 | TextField | 入力 | 請求書ファイルの自動命名ルール（multiline対応） |
| ファイル命名規則表示 | Paper+Typography | 出力 | 命名規則の表示（monospace、改行対応、単語分割） |
| 番号発番ルール | TextField | 入力 | 請求書番号の自動生成パターン |
| 番号発番ルール表示 | Paper+Typography | 出力 | 発番ルールの表示（monospace、改行対応、単語分割） |
| 品目名記載ルール | TextField | 入力 | 品目欄の表示形式設定 |
| 品目名記載ルール表示 | Paper+Typography | 出力 | 記載ルールの表示（monospace、改行対応、単語分割） |
| 保存先URL | TextField | 入力 | ファイル保存先のURL設定（multiline、2行） |
| 保存先URL表示 | Paper+Typography | 出力 | 保存先URLの表示（monospace、改行対応、単語分割） |
| 編集ボタン | IconButton | 入力 | 設定項目の編集開始 |
| 保存ボタン | IconButton | 入力 | 設定内容の保存 |

#### 利用可能変数セクション

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 発番ルール変数一覧 | Table | 出力 | 発番ルール変数の表示（変数名35%、説明40%、例25%） |
| ファイル命名規則変数一覧 | Table | 出力 | ファイル命名規則変数の表示（変数名35%、説明40%、例25%） |
| 品目名記載ルール変数一覧 | Table | 出力 | 品目名記載ルール変数の表示（変数名35%、説明40%、例25%） |

#### 使用可能変数一覧

##### 発番ルール変数

| 変数名 | 説明 | 例 |
| --- | --- | --- |
| ${yyyy} | 書類作成日の西暦年 | 2024 |
| ${mm} | 書類作成日の月（2桁） | 01 |
| ${dd} | 書類作成日の日（2桁） | 15 |
| ${number,【桁数】,【初期値】} | 連番値（桁数・初期値指定） | 00001 |

##### ファイル命名規則変数

| 変数名 | 説明 | 例 |
| --- | --- | --- |
| ${yyyy,【加減】} | 書類作成日の西暦年（加減可能） | 2024 |
| ${mm,【加減】} | 書類作成日の月（2桁、加減可能） | 01 |
| ${dd,【加減】} | 書類作成日の日（2桁、加減可能） | 15 |
| ${c_company} | 取引先の会社名 | 株式会社ABC |

##### 品目名記載ルール変数

| 変数名 | 説明 | 例 |
| --- | --- | --- |
| ${column,【対象の列名】} | 対象の列名から取得した値 | イオンモール上尾 |
| ${space} | 空白文字 | 　 |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| 設定編集開始 | 編集ボタンクリック | 設定項目の編集モード切替 | 同画面 | なし |
| 設定保存 | 保存ボタンクリック | 設定内容の保存 | 同画面 | 変数構文チェック |
| 変数コピー | 変数名クリック | 変数をクリップボードにコピー | 同画面 | なし |
| テキスト改行表示 | テキスト表示時 | 長いテキストの自動改行処理 | 同画面 | なし |
| multiline入力 | 保存先URL編集時 | 複数行入力対応 | 同画面 | URL形式チェック |

---

## 2-5. 経理ルールタブ

### UI 要素・コントロール・I/O

#### 経理ルール設定セクション

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 消費税率 | TextField | 入力 | 現在の消費税率（%、数値入力） |
| 編集ボタン | IconButton | 入力 | ルールの編集開始 |
| 保存ボタン | IconButton | 入力 | ルールの保存 |

#### 振込期日設定ルールセクション

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 月選択 | Select | 入力 | 翌月・当月・翌々月 |
| 日付選択 | Select | 入力 | 末日・15日・10日・25日 |
| 営業日ルール | Button | 入力 | 前営業日・後営業日・考慮しない |

#### ルール説明セクション

| 要素名 | コントロール種類 | I/O | 説明 |
| --- | --- | --- | --- |
| 消費税率説明 | Typography | 出力 | 消費税率設定の説明 |
| 振込期日ルール説明 | Typography | 出力 | 振込期日設定の説明 |

### イベント定義

| イベント名 | 発生タイミング | イベント概要 | 遷移先 | バリデーション |
| --- | --- | --- | --- | --- |
| ルール編集開始 | 編集ボタンクリック | 経理ルール編集モード切替 | 同画面 | なし |
| ルール保存 | 保存ボタンクリック | 経理ルールの保存 | 同画面 | 数値範囲チェック |
| 月選択変更 | 月セレクト変更 | 振込期日月の変更 | 同画面 | なし |
| 日付選択変更 | 日付セレクト変更 | 振込期日日付の変更 | 同画面 | なし |
| 営業日ルール変更 | 営業日ボタンクリック | 営業日調整ルールの変更 | 同画面 | なし |

---

## 技術仕様

### テキスト表示の改行対応

#### 実装内容
すべてのテキスト表示コンポーネント（Paper+Typography）に以下のCSSプロパティを適用：

```css
{
  wordBreak: 'break-all',      // 長い単語も強制的に改行
  whiteSpace: 'pre-wrap',      // 改行とスペースを保持  
  overflowWrap: 'anywhere'     // 必要に応じてどこでも改行
}
```

#### 適用対象
- **メール設定タブ**: 件名・本文テンプレート表示
- **文書設定タブ**: 全設定項目の表示（ファイル命名規則、発番ルール、品目名記載ルール、保存先URL）

#### multiline入力対応
- **保存先URL**: `multiline={true}` + `rows={2}`で複数行入力対応
- **その他項目**: 必要に応じて`multiline`対応

#### 変数表示の統一
- **Table形式**: Chipから統一されたTable表示に変更
- **列幅統一**: 変数名35%、説明40%、例25%の固定幅
- **フォント統一**: 変数名と例は`monospace`フォント

### メールプレビュー機能

#### 実装内容
見積書・請求書送付メールのプレビュー機能を実装。変数をサンプル値に置換してメール内容を確認可能。

#### プレビューダイアログ仕様
- **サイズ**: `maxWidth="md"` + `fullWidth`
- **タイトル**: 見積書/請求書送付メールプレビュー（アイコン付き）
- **件名表示**: `Paper`コンテナ内に`Typography`で表示
- **本文表示**: `Paper`コンテナ内に`Typography`で表示
- **フォント**: `monospace`フォント
- **行間**: `lineHeight: 1.2`（実際のメール風）
- **改行処理**: `whiteSpace: 'pre-wrap'`
- **文字折り返し**: `wordBreak: 'break-all'`

#### 変数処理システム（最新版）

**データ取得元**:
| 変数カテゴリ | データソース | 説明 |
| --- | --- | --- |
| ${c_name,*} | UserProfileSettings | ユーザー情報設定の姓・名から取得 |
| ${u_mail} | UserProfileSettings | ユーザー情報設定のメールアドレスから取得 |
| ${m_company} | CompanyBasicSettings | 会社基本設定の会社名から取得 |
| ${m_tel} | CompanyBasicSettings | 会社基本設定の電話番号から取得 |
| ${m_mail} | CompanyBasicSettings | 会社基本設定のメールアドレスから取得 |
| ${m_url} | CompanyBasicSettings | 会社基本設定のURLから取得 |

**変数置換例**:
```javascript
// 実データ対応変数
${c_name,0} → currentUser.name (田中太郎)
${c_name,1} → currentUser.lastName (田中)
${u_mail} → currentUser.email (tanaka@ansteype.com)
${m_company} → companySettings.companyName (株式会社ANSTEYPE)
${m_tel} → companySettings.phone (048-123-4567)
${m_url} → companySettings.url (ansteype.com)
```

**プレビュー処理順序**:
1. 名前系変数（番号指定あり）の処理
2. 日付系変数（加減計算あり）の処理
3. 箇条書き変数の処理
4. column変数の処理
5. 基本変数の処理
6. 汎用フォールバック処理

**変数の適用範囲**:
| タブ | 使用する変数カテゴリ | 説明 |
| --- | --- | --- |
| メール設定 | メール作成用変数 | ${c_name}, ${m_*}, ${u_mail}, ${yyyy}, ${/r}, ${space}, ${list}, ${item} |
| 文書設定 | 文書作成用変数 | ${yyyy}, ${mm}, ${dd}, ${c_company}, ${number}, ${column}, ${space} |
| 経理ルール | 経理関連変数 | 数値設定のみ（変数なし） |

**署名構成例（メール設定タブ）**:
```
------------------------
${m_company}    ← 会社基本設定から取得
${c_name,0}     ← ユーザー情報設定から取得
TEL：${m_tel}   ← 会社基本設定から取得
EMAIL：${u_mail} ← ユーザー情報設定から取得
URL：${m_url}   ← 会社基本設定から取得
------------------------
```

**文書命名例（文書設定タブ）**:
```
ファイル名: 【${c_company}御中】御見積書_${yyyy,0}${mm,0}
発番ルール: Q-${yyyy}${mm}${dd}-${number,5,1}
品目名: ${column,イベント実施場所}${space}${column,オーダー}${space}${column,人数}名
```






